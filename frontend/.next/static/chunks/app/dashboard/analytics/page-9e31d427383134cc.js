(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[171],{46489:function(e,t,s){Promise.resolve().then(s.bind(s,14547))},14547:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return S}});var a=s(57437),r=s(2265),l=s(19465),n=s(93448),i=s(38668),c=s(3964),o=s(95252),d=s(41671),x=s(46211),u=s(99388),p=s(76865),f=s(91436),h=s(21156),m=s(56940),j=s(97059),b=s(62994),g=s(77719),v=s(55487),y=s(77031),N=s(96934),k=s(20407);let w=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],C=["#3b82f6","#22c55e","#f59e0b","#ef4444","#8b5cf6","#06b6d4","#ec4899","#f97316"];function S(){return(0,a.jsx)(i.p,{allowedRoles:["admin"],children:(0,a.jsx)(T,{})})}function T(){let[e,t]=(0,r.useState)(null),[s,i]=(0,r.useState)([]),[S,T]=(0,r.useState)([]),[A,E]=(0,r.useState)([]),[Z,z]=(0,r.useState)([]),[L,D]=(0,r.useState)(!0),[R,K]=(0,r.useState)(null);(0,r.useEffect)(()=>{P()},[]);let P=async()=>{var e,s,a;try{let[s,a,r,n,c]=await Promise.all([l.x1.get("/analytics/summary"),l.x1.get("/analytics/monthly-trend"),l.x1.get("/analytics/top-spenders"),l.x1.get("/analytics/violations"),l.x1.get("/analytics/manager-performance")]);t(s.data.data),i(a.data.data||[]),T(r.data.data||[]),E((null===(e=n.data.data)||void 0===e?void 0:e.violationCountByCode)||[]),z(c.data.data||[])}catch(e){K((null===(a=e.response)||void 0===a?void 0:null===(s=a.data)||void 0===s?void 0:s.message)||"Failed to load analytics")}finally{D(!1)}};if(L)return(0,a.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,a.jsx)(c.$j,{size:"lg"})});if(R)return(0,a.jsx)("div",{className:"p-4 bg-danger-600/10 border border-danger-600/30 rounded-xl",children:(0,a.jsx)("p",{className:"text-sm text-danger-500",children:R})});let F=s.map(e=>({label:"".concat(w[e.month-1]," ").concat(e.year),amount:e.totalAmount,count:e.expenseCount})),O=[{label:"Total Expenses",value:(0,n.xG)((null==e?void 0:e.totalExpenseAmount)||0),icon:o.Z,color:"text-primary-400",bg:"bg-primary-600/20"},{label:"Approved",value:(0,n.xG)((null==e?void 0:e.approvedExpenseAmount)||0),icon:d.Z,color:"text-success-500",bg:"bg-success-600/20"},{label:"Flagged",value:(0,n.xG)((null==e?void 0:e.flaggedExpenseAmount)||0),icon:x.Z,color:"text-warning-500",bg:"bg-warning-600/20"},{label:"Rejected",value:(0,n.xG)((null==e?void 0:e.rejectedExpenseAmount)||0),icon:u.Z,color:"text-danger-500",bg:"bg-danger-600/20"},{label:"Total Count",value:(null==e?void 0:e.totalCount)||0,icon:p.Z,color:"text-surface-300",bg:"bg-surface-700"}];return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-surface-100",children:"Analytics Dashboard"}),(0,a.jsx)("p",{className:"text-surface-400 mt-1",children:"Organization-wide spend and performance insights"})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4",children:O.map(e=>(0,a.jsx)(c.Zb,{children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("div",{className:"p-2.5 rounded-xl ".concat(e.bg),children:(0,a.jsx)(e.icon,{className:"h-5 w-5 ".concat(e.color)})}),(0,a.jsxs)("div",{className:"min-w-0",children:[(0,a.jsx)("p",{className:"text-xs text-surface-500 uppercase tracking-wide",children:e.label}),(0,a.jsx)("p",{className:"text-xl font-bold text-surface-100 mt-0.5 truncate",children:e.value})]})]})},e.label))}),(0,a.jsxs)(c.Zb,{children:[(0,a.jsx)(c.Ol,{title:"Monthly Spend Trend",description:"Last 12 months"}),F.length>0?(0,a.jsx)("div",{className:"h-72 mt-4",children:(0,a.jsx)(f.h,{width:"100%",height:"100%",children:(0,a.jsxs)(h.w,{data:F,children:[(0,a.jsx)(m.q,{strokeDasharray:"3 3",stroke:"#334155"}),(0,a.jsx)(j.K,{dataKey:"label",tick:{fill:"#94a3b8",fontSize:12},axisLine:{stroke:"#334155"},tickLine:!1}),(0,a.jsx)(b.B,{tick:{fill:"#94a3b8",fontSize:12},axisLine:{stroke:"#334155"},tickLine:!1,tickFormatter:e=>"₹".concat((e/1e3).toFixed(0),"k")}),(0,a.jsx)(g.u,{contentStyle:{backgroundColor:"#1e293b",border:"1px solid #334155",borderRadius:"12px",color:"#f1f5f9"},formatter:e=>[(0,n.xG)(e),"Amount"]}),(0,a.jsx)(v.x1,{type:"monotone",dataKey:"amount",stroke:"#3b82f6",strokeWidth:2,dot:{fill:"#3b82f6",r:4},activeDot:{r:6}})]})})}):(0,a.jsx)("p",{className:"text-surface-500 text-sm py-8 text-center",children:"No data available"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,a.jsxs)(c.Zb,{children:[(0,a.jsx)(c.Ol,{title:"Top Spenders",description:"Top 10 by total spend"}),S.length>0?(0,a.jsx)("div",{className:"h-72 mt-4",children:(0,a.jsx)(f.h,{width:"100%",height:"100%",children:(0,a.jsxs)(y.v,{data:S,layout:"vertical",margin:{left:20},children:[(0,a.jsx)(m.q,{strokeDasharray:"3 3",stroke:"#334155",horizontal:!1}),(0,a.jsx)(j.K,{type:"number",tick:{fill:"#94a3b8",fontSize:12},axisLine:{stroke:"#334155"},tickLine:!1,tickFormatter:e=>"₹".concat((e/1e3).toFixed(0),"k")}),(0,a.jsx)(b.B,{type:"category",dataKey:"name",tick:{fill:"#94a3b8",fontSize:11},axisLine:{stroke:"#334155"},tickLine:!1,width:100}),(0,a.jsx)(g.u,{contentStyle:{backgroundColor:"#1e293b",border:"1px solid #334155",borderRadius:"12px",color:"#f1f5f9"},formatter:e=>[(0,n.xG)(e),"Total Spend"]}),(0,a.jsx)(N.$Q,{dataKey:"totalAmount",radius:[0,6,6,0],children:S.map((e,t)=>(0,a.jsx)(k.b,{fill:C[t%C.length]},t))})]})})}):(0,a.jsx)("p",{className:"text-surface-500 text-sm py-8 text-center",children:"No data available"})]}),(0,a.jsxs)(c.Zb,{children:[(0,a.jsx)(c.Ol,{title:"Violation Distribution",description:"By violation code"}),A.length>0?(0,a.jsx)("div",{className:"h-72 mt-4",children:(0,a.jsx)(f.h,{width:"100%",height:"100%",children:(0,a.jsxs)(y.v,{data:A,children:[(0,a.jsx)(m.q,{strokeDasharray:"3 3",stroke:"#334155"}),(0,a.jsx)(j.K,{dataKey:"code",tick:{fill:"#94a3b8",fontSize:11},axisLine:{stroke:"#334155"},tickLine:!1}),(0,a.jsx)(b.B,{tick:{fill:"#94a3b8",fontSize:12},axisLine:{stroke:"#334155"},tickLine:!1}),(0,a.jsx)(g.u,{contentStyle:{backgroundColor:"#1e293b",border:"1px solid #334155",borderRadius:"12px",color:"#f1f5f9"},formatter:(e,t)=>[e,"expenseCount"===t?"Expense":"travelRequestCount"===t?"Travel":t]}),(0,a.jsx)(N.$Q,{dataKey:"expenseCount",fill:"#f59e0b",stackId:"stack",radius:[0,0,0,0],name:"expenseCount"}),(0,a.jsx)(N.$Q,{dataKey:"travelRequestCount",fill:"#ef4444",stackId:"stack",radius:[4,4,0,0],name:"travelRequestCount"})]})})}):(0,a.jsx)("p",{className:"text-surface-500 text-sm py-8 text-center",children:"No violations recorded"})]})]}),(0,a.jsxs)(c.Zb,{className:"overflow-hidden p-0",children:[(0,a.jsx)("div",{className:"px-6 pt-5 pb-3",children:(0,a.jsx)(c.Ol,{title:"Top Spenders — Detail"})}),S.length>0?(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{className:"bg-surface-700/50 border-y border-surface-700",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-semibold text-surface-300 uppercase tracking-wider",children:"User"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-semibold text-surface-300 uppercase tracking-wider",children:"Email"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-semibold text-surface-300 uppercase tracking-wider",children:"Total Spend"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-semibold text-surface-300 uppercase tracking-wider",children:"Expenses"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-surface-700",children:S.map((e,t)=>(0,a.jsxs)("tr",{className:"hover:bg-surface-700/30 transition-colors",children:[(0,a.jsx)("td",{className:"px-6 py-3",children:(0,a.jsx)(c.sM,{name:e.name,email:e.email,size:"sm"})}),(0,a.jsx)("td",{className:"px-6 py-3 text-sm text-surface-400",children:e.email}),(0,a.jsx)("td",{className:"px-6 py-3 text-sm font-semibold text-surface-100",children:(0,n.xG)(e.totalAmount)}),(0,a.jsx)("td",{className:"px-6 py-3 text-sm text-surface-300",children:e.expenseCount})]},t))})]})}):(0,a.jsx)("p",{className:"text-surface-500 text-sm py-8 text-center",children:"No data"})]}),(0,a.jsxs)(c.Zb,{className:"overflow-hidden p-0",children:[(0,a.jsx)("div",{className:"px-6 pt-5 pb-3",children:(0,a.jsx)(c.Ol,{title:"Manager Performance"})}),Z.length>0?(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{className:"bg-surface-700/50 border-y border-surface-700",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-semibold text-surface-300 uppercase tracking-wider",children:"Manager"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-semibold text-surface-300 uppercase tracking-wider",children:"Approvals"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-semibold text-surface-300 uppercase tracking-wider",children:"Rejections"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-semibold text-surface-300 uppercase tracking-wider",children:"Total"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-semibold text-surface-300 uppercase tracking-wider",children:"Avg. Approval Time"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-surface-700",children:Z.map((e,t)=>(0,a.jsxs)("tr",{className:"hover:bg-surface-700/30 transition-colors",children:[(0,a.jsx)("td",{className:"px-6 py-3",children:(0,a.jsx)(c.sM,{name:e.name,email:e.email,size:"sm"})}),(0,a.jsx)("td",{className:"px-6 py-3 text-sm text-success-500 font-semibold",children:e.approvedCount}),(0,a.jsx)("td",{className:"px-6 py-3 text-sm text-danger-500 font-semibold",children:e.rejectedCount}),(0,a.jsx)("td",{className:"px-6 py-3 text-sm text-surface-200",children:e.totalDecisions}),(0,a.jsx)("td",{className:"px-6 py-3 text-sm text-surface-300",children:null!==e.avgApprovalTimeHours?"".concat(e.avgApprovalTimeHours,"h"):"—"})]},t))})]})}):(0,a.jsx)("p",{className:"text-surface-500 text-sm py-8 text-center",children:"No data"})]})]})}},38668:function(e,t,s){"use strict";s.d(t,{I:function(){return c},p:function(){return d}});var a=s(57437),r=s(2265),l=s(99376),n=s(95932),i=s(3964);function c(e){let{children:t}=e,s=(0,l.useRouter)(),{isAuthenticated:c,isLoading:o,user:d}=(0,n.aC)();return((0,r.useEffect)(()=>{o||c?!o&&c&&(null==d?void 0:d.mustChangePassword)&&!window.location.pathname.startsWith("/change-password")&&s.replace("/change-password"):s.replace("/login")},[c,o,s]),o)?(0,a.jsx)("div",{className:"min-h-screen bg-surface-950 flex items-center justify-center",children:(0,a.jsx)(i.$j,{size:"lg"})}):c?(0,a.jsx)(a.Fragment,{children:t}):null}var o=s(86563);function d(e){let{children:t,allowedRoles:s,fallbackUrl:i="/dashboard"}=e,c=(0,l.useRouter)(),{role:d,isLoading:x}=(0,n.aC)(),u=d&&s.includes(d);return((0,r.useEffect)(()=>{x||u||c.replace(i)},[u,x,c,i]),x)?null:u?(0,a.jsx)(a.Fragment,{children:t}):(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center py-12",children:[(0,a.jsx)(o.Z,{className:"h-12 w-12 text-surface-500 mb-4"}),(0,a.jsx)("h2",{className:"text-lg font-semibold text-surface-300",children:"Access Denied"}),(0,a.jsx)("p",{className:"text-sm text-surface-500 mt-1",children:"You don't have permission to view this page."})]})}},14362:function(e,t,s){"use strict";s.d(t,{AuthProvider:function(){return o},useAuth:function(){return d}});var a=s(57437),r=s(2265),l=s(14474),n=s(37994),i=s(42590);let c=(0,r.createContext)(void 0);function o(e){let{children:t}=e,[s,o]=(0,r.useState)(null),[d,x]=(0,r.useState)(!0),u=(0,r.useCallback)(e=>{try{return(0,l.o)(e)}catch(e){return null}},[]),p=(0,r.useCallback)(async()=>{try{let e=await i.Z.get("/auth/profile");e.data.success&&o(e.data.data)}catch(e){(0,n.yE)(),o(null)}},[]);(0,r.useEffect)(()=>{(async()=>{let e=(0,n.lz)();if(null==e?void 0:e.accessToken){let t=u(e.accessToken);if(t&&1e3*t.exp>Date.now())await p();else try{let t=(await i.Z.post("/auth/refresh",{refreshToken:e.refreshToken})).data.data;(0,n.d0)(t),await p()}catch(e){(0,n.yE)()}}x(!1)})()},[u,p]);let f=(0,r.useCallback)(async(e,t)=>{let s=await i.Z.post("/auth/login",{email:e,password:t});if(s.data.success){let{accessToken:e,refreshToken:t,user:a}=s.data.data;(0,n.d0)({accessToken:e,refreshToken:t}),o(a)}else throw Error(s.data.message||"Login failed")},[]),h=(0,r.useCallback)(()=>{let e=(0,n.lz)();(null==e?void 0:e.refreshToken)&&i.Z.post("/auth/logout",{refreshToken:e.refreshToken}).catch(()=>{}),(0,n.yE)(),o(null)},[]),m={user:s,role:(null==s?void 0:s.role)||null,isAuthenticated:!!s,isLoading:d,login:f,logout:h};return(0,a.jsx)(c.Provider,{value:m,children:t})}function d(){let e=(0,r.useContext)(c);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},98319:function(e,t,s){"use strict";s.d(t,{ToastProvider:function(){return p},useToast:function(){return d}});var a=s(57437),r=s(2265),l=s(41671),n=s(99388),i=s(33245),c=s(32489);let o=(0,r.createContext)(null);function d(){let e=(0,r.useContext)(o);if(!e)throw Error("useToast must be used within ToastProvider");return e}let x={success:l.Z,error:n.Z,info:i.Z},u={success:"bg-success-600/90 text-white",error:"bg-danger-600/90 text-white",info:"bg-primary-600/90 text-white"};function p(e){let{children:t}=e,[s,l]=(0,r.useState)([]),n=(0,r.useCallback)((e,t)=>{let s=Date.now().toString()+Math.random().toString(36).slice(2);l(a=>[...a,{id:s,type:e,message:t}]),setTimeout(()=>{l(e=>e.filter(e=>e.id!==s))},4e3)},[]),i=(0,r.useCallback)(e=>{l(t=>t.filter(t=>t.id!==e))},[]);return(0,a.jsxs)(o.Provider,{value:{toast:{success:e=>n("success",e),error:e=>n("error",e),info:e=>n("info",e)}},children:[t,(0,a.jsx)("div",{className:"fixed bottom-6 right-6 z-[9999] flex flex-col gap-2 pointer-events-none",children:s.map(e=>{let t=x[e.type];return(0,a.jsxs)("div",{className:"pointer-events-auto flex items-center gap-3 px-4 py-3 rounded-xl shadow-lg ".concat(u[e.type]," animate-slide-up min-w-[280px] max-w-[400px]"),children:[(0,a.jsx)(t,{className:"h-5 w-5 flex-shrink-0"}),(0,a.jsx)("p",{className:"text-sm flex-1",children:e.message}),(0,a.jsx)("button",{onClick:()=>i(e.id),className:"opacity-70 hover:opacity-100",children:(0,a.jsx)(c.Z,{className:"h-4 w-4"})})]},e.id)})})]})}},95932:function(e,t,s){"use strict";s.d(t,{aC:function(){return a.useAuth},pm:function(){return r.useToast}});var a=s(14362),r=s(98319)},19465:function(e,t,s){"use strict";s.d(t,{x1:function(){return a.Z}});var a=s(42590)}},function(e){e.O(0,[647,611,183,971,117,744],function(){return e(e.s=46489)}),_N_E=e.O()}]);